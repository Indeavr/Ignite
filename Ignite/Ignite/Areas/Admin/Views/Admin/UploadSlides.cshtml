@model List<Ignite.Areas.Admin.ViewModels.ImageViewModel>

@{
    int courseId = ViewBag.courseId;
}

<h2>UploadSlides</h2>

<div class="jumbotron">
    @using (Html.BeginForm("UploadSlidesToDb", "Admin", new { courseId = courseId }, FormMethod.Post,
                                                                        new { @class = "dropzone", id = "myId" }))
    {
    }

    <button id="submit-all">
        Upload Files
    </button>
</div>
@section scripts {
    @Scripts.Render("~/bundles/dropzonescripts");

    <script>
        $(document).ready(function () {
            Dropzone.autoDiscover = false;

            $("#myId").dropzone({
                acceptedFiles: ".png,.jpg,.jpeg",
                autoProcessQueue: false,
                uploadMultiple: true,
                parallelUploads: 10,
                addRemoveLinks: true,
                removedfile: function (file) {
                    var ref;
                    return (ref = file.previewElement) != null ? ref.parentNode.removeChild(file.previewElement) : void 0;
                },

                init: function () {
                    myDropzone = this;

                    myDropzone.on("success", (function(_this) {
                        return function(file) {
                            if (_this.getQueuedFiles().length === 0) {
                                setTimeout(function(){window.location.href='@Url.Action("DoneUploading")'},100);
                             }
                         };
                    })(myDropzone));
                },
            });

            let submitButton = document.querySelector("#submit-all")
            submitButton.addEventListener("click", function () {
                myDropzone.processQueue();
            });
        });

        @*let adPhotosDropzone = new Dropzone("form#dropzoneJsForm", {
            autoProcessQueue: false,
            parallelUploads: 3
        });*@

       // Dropzone.autoDiscover = false;

        // var dropzoneJsForm = new Dropzone("#dropzoneJsForm");

        @*$('#submit-all').click(function () {
            dropzoneJsForm.options.autoProcessQueue = true;
            dropzoneJsForm.processQueue();
        });

        Dropzone.options.dropzoneJsForm = {
            autoProcessQueue: false,
            parallelUploads: 10,
          //  url: location.href = '@Url.Action("UploadSlides", "Admin")',

            init: function () {
                this.on("complete", function (data) {
                    //var res = eval('(' + data.xhr.responseText + ')');
                    var res = JSON.parse(data.xhr.responseText);
                }),
                    this.on("queuecomplete", function (file) {
                        dropzoneForm.options.autoProcessQueue = false;
                    });

            }
        }*@

        //Dropzone.autoDiscover = false;
        //$("div#dropzonePreview").dropzone(
        //    {
        //        url: "~/admin/admin/uploadslides",
        //        paramName: "images",
        //        autoProcessQueue: true,
        //        addRemoveLinks: true,
        //        //clickable: "#dropzonePreview",
        //        uploadMultiple: true,
        //       // acceptedFiles: "image/*",
        //        maxFiles: 100,
        //        parallelUploads: 10,
        //        dictInvalidFileType: "Please upload an image",
        //        dictFileTooBig: "Billedet er for stort",
        //        success: function (file, response) {
        //            $('#ImageIds').val($('#ImageIds').val() + "," + response.Ids);
        //            done();
        //        }
        //    });

        //var theDropzone = $("dropzoneForm").dropzone({ url: "~/admin/admin/uploadslides" });
        //Dropzone.options.theDropzone = {
        //      init: function () {
        //          this.on("addedfile", function (file) { alert("Added file."); });
        //      },
        //      paramName: "file", // The name that will be used to transfer the file
        //      maxFilesize: 2, // MB
        //      accept: function (file, done) {
        //        if (file.name == "azis.jpg") {
        //            done("Naha, you don't.");
        //        }
        //        else { done(); }
        //       },
        //       uploadMultiple: true,


        //};


        //File Upload response from the server
        //Dropzone.options.dropzoneForm = {
        //    init: function () {
        //        this.on("complete", function (data) {
        //            //var res = eval('(' + data.xhr.responseText + ')');
        //            var res = JSON.parse(data.xhr.responseText);
        //        });
        //    }
        //};
    </script>
}

